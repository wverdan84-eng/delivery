<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Loja Profissional</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { background-color: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* Header */
        header { background: white; padding: 1rem 5%; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        .cart-icon { position: relative; cursor: pointer; font-size: 1.2rem; }
        .cart-count { position: absolute; top: -8px; right: -8px; background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; font-weight: bold; }

        /* Hero Section */
        .hero { text-align: center; padding: 3rem 1rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; margin-bottom: 2rem; }
        .hero h1 { margin-bottom: 0.5rem; }

        /* Filters */
        .controls { max-width: 1200px; margin: 0 auto 2rem; padding: 0 1rem; display: flex; gap: 1rem; flex-wrap: wrap; }
        .search-bar { flex: 1; padding: 0.8rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .category-filter { padding: 0.8rem; border: 1px solid #ddd; border-radius: 8px; background: white; }

        /* Grid de Produtos */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 2rem; max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        
        .product-card { background: var(--card-bg); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: transform 0.2s; display: flex; flex-direction: column; }
        .product-card:hover { transform: translateY(-5px); }
        .product-img { width: 100%; height: 200px; object-fit: cover; background: #eee; }
        .product-info { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; }
        .product-cat { font-size: 0.8rem; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .product-title { font-size: 1.1rem; font-weight: bold; margin: 0.5rem 0; }
        .product-price { font-size: 1.3rem; color: var(--primary); font-weight: bold; margin-top: auto; }
        .add-btn { width: 100%; padding: 0.8rem; background: var(--primary); color: white; border: none; border-radius: 6px; margin-top: 1rem; cursor: pointer; transition: background 0.2s; }
        .add-btn:hover { background: var(--secondary); }

        /* Modal do Carrinho */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: flex-end; }
        .modal.active { display: flex; }
        .cart-sidebar { background: white; width: 100%; max-width: 400px; height: 100%; padding: 2rem; display: flex; flex-direction: column; animation: slideIn 0.3s; }
        
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid #eee; padding-bottom: 1rem; }
        .close-cart { cursor: pointer; font-size: 1.5rem; }
        .cart-items { flex-grow: 1; overflow-y: auto; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid #f0f0f0; padding-bottom: 0.5rem; }
        .cart-item-info h4 { font-size: 0.9rem; }
        .cart-total { font-size: 1.5rem; font-weight: bold; margin: 1rem 0; text-align: right; }
        .checkout-btn { width: 100%; padding: 1rem; background: #25D366; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .checkout-btn:hover { background: #128C7E; }
        .remove-item { color: red; cursor: pointer; margin-left: 10px; }

        /* Loading */
        #loading { text-align: center; padding: 2rem; font-size: 1.2rem; color: #666; }
    </style>
</head>
<body>

    <header>
        <div class="logo"><i class="fas fa-store"></i> UltraStore</div>
        <div class="cart-icon" onclick="toggleCart()">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cartCount">0</span>
        </div>
    </header>

    <div class="hero">
        <h1>Bem-vindo à Melhor Loja</h1>
        <p>Produtos selecionados com qualidade premium</p>
    </div>

    <div class="controls">
        <input type="text" id="searchInput" class="search-bar" placeholder="Buscar produtos..." oninput="filterProducts()">
        <select id="categoryFilter" class="category-filter" onchange="filterProducts()">
            <option value="all">Todas Categorias</option>
        </select>
    </div>

    <div id="loading"><i class="fas fa-spinner fa-spin"></i> Carregando catálogo...</div>
    <div class="products-grid" id="productsGrid"></div>

    <div class="modal" id="cartModal">
        <div class="cart-sidebar">
            <div class="cart-header">
                <h2>Seu Carrinho</h2>
                <span class="close-cart" onclick="toggleCart()">&times;</span>
            </div>
            <div class="cart-items" id="cartItemsContainer">
                <p>Seu carrinho está vazio.</p>
            </div>
            <div class="cart-footer">
                <div class="cart-total">Total: R$ <span id="cartTotal">0.00</span></div>
                <button class="checkout-btn" onclick="checkout()">
                    <i class="fab fa-whatsapp"></i> Finalizar no WhatsApp
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÃO (Edite aqui) ---
        // 1. Publique sua planilha na web (Arquivo > Compartilhar > Publicar na Web > CSV)
        // 2. Cole o ID da planilha abaixo:
        const SHEET_ID = '1YYobMz2udkbtX9P9N76QhTvCJkNXnxpYUbNvv3M4G_M'; 
        const WHATSAPP_NUMBER = '5527997566512'; // Seu número com DDD
        // ---------------------------------

        let allProducts = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        async function fetchProducts() {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
            
            try {
                const response = await fetch(url);
                const text = await response.text();
                allProducts = csvToJson(text);
                renderProducts(allProducts);
                populateCategories(allProducts);
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error('Erro ao carregar:', error);
                // Dados de fallback para teste se a planilha falhar
                allProducts = [
                    {id: 1, nome: "Produto Exemplo 1", preco: 99.90, imagem: "https://via.placeholder.com/300", categoria: "Eletrônicos", descricao: "Descrição teste"},
                    {id: 2, nome: "Produto Exemplo 2", preco: 149.50, imagem: "https://via.placeholder.com/300", categoria: "Moda", descricao: "Descrição teste"}
                ];
                renderProducts(allProducts);
                document.getElementById('loading').style.display = 'none';
                alert('Atenção: Usando produtos de teste. Verifique o ID da sua planilha.');
            }
        }

        function csvToJson(csv) {
            const rows = csv.split('\n').map(row => row.split(','));
            const headers = rows[0].map(header => header.replace(/"/g, '').trim());
            return rows.slice(1).map(row => {
                let obj = {};
                row.forEach((val, i) => {
                    if(headers[i]) obj[headers[i]] = val.replace(/"/g, '').trim();
                });
                return obj;
            });
        }

        function renderProducts(products) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(p => `
                <div class="product-card">
                    <img src="${p.imagem}" alt="${p.nome}" class="product-img">
                    <div class="product-info">
                        <span class="product-cat">${p.categoria}</span>
                        <h3 class="product-title">${p.nome}</h3>
                        <p style="font-size:0.9rem; color:#777; margin-bottom:10px">${p.descricao}</p>
                        <div class="product-price">R$ ${parseFloat(p.preco).toFixed(2)}</div>
                        <button class="add-btn" onclick="addToCart('${p.id}')">Adicionar ao Carrinho</button>
                    </div>
                </div>
            `).join('');
        }

        function populateCategories(products) {
            const categories = [...new Set(products.map(p => p.categoria))];
            const select = document.getElementById('categoryFilter');
            categories.forEach(c => {
                if(c) select.innerHTML += `<option value="${c}">${c}</option>`;
            });
        }

        function filterProducts() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const cat = document.getElementById('categoryFilter').value;
            
            const filtered = allProducts.filter(p => {
                const matchSearch = p.nome.toLowerCase().includes(search) || p.descricao.toLowerCase().includes(search);
                const matchCat = cat === 'all' || p.categoria === cat;
                return matchSearch && matchCat;
            });
            renderProducts(filtered);
        }

        function addToCart(id) {
            const product = allProducts.find(p => p.id == id);
            const existing = cart.find(item => item.id == id);
            
            if(existing) {
                existing.qty++;
            } else {
                cart.push({...product, qty: 1});
            }
            updateCart();
            toggleCart(); // Opcional: abre o carrinho ao adicionar
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id != id);
            updateCart();
        }

        function updateCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            document.getElementById('cartCount').innerText = cart.reduce((acc, item) => acc + item.qty, 0);
            
            const container = document.getElementById('cartItemsContainer');
            if(cart.length === 0) {
                container.innerHTML = '<p>Seu carrinho está vazio.</p>';
                document.getElementById('cartTotal').innerText = '0.00';
                return;
            }

            let total = 0;
            container.innerHTML = cart.map(item => {
                const subtotal = item.price ? item.price * item.qty : item.preco * item.qty;
                total += subtotal;
                return `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <h4>${item.nome} (${item.qty}x)</h4>
                            <span>R$ ${parseFloat(item.preco).toFixed(2)}</span>
                        </div>
                        <i class="fas fa-trash remove-item" onclick="removeFromCart('${item.id}')"></i>
                    </div>
                `;
            }).join('');
            
            document.getElementById('cartTotal').innerText = total.toFixed(2);
        }

        function toggleCart() {
            const modal = document.getElementById('cartModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'flex';
            }
        }
        
        // Fechar modal ao clicar fora
        document.getElementById('cartModal').addEventListener('click', function(e) {
            if (e.target === this) toggleCart();
        });

        function checkout() {
            if(cart.length === 0) return alert('Carrinho vazio!');
            
            let message = "Olá! Gostaria de fazer um pedido:\n\n";
            let total = 0;
            
            cart.forEach(item => {
                const subtotal = item.preco * item.qty;
                total += subtotal;
                message += `▪️ ${item.qty}x ${item.nome} - R$ ${parseFloat(item.preco).toFixed(2)}\n`;
            });
            
            message += `\n*Total: R$ ${total.toFixed(2)}*`;
            message += `\n\nAguardo confirmação de pagamento e entrega.`;
            
            const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        // Inicialização
        fetchProducts();
        updateCart();
    </script>
</body>
</html>
