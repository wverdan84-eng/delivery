<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel SaaS Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.css">
    <style>
        body { background: #f0f2f5; }
        .card { border-radius: 20px; border: none; }
    </style>
</head>
<body>
    <div id="login-screen" class="padding center-align" style="max-width:400px; margin: 10vh auto;">
        <h4>ðŸš€ Meu NegÃ³cio</h4>
        <div class="field label border round"><input type="email" id="email"><label>Email</label></div>
        <div class="field label border round"><input type="password" id="senha"><label>Senha</label></div>
        <button class="fill primary full-width round" onclick="handleLogin()">Entrar</button>
    </div>

    <main id="admin-panel" style="display:none">
        <header class="primary shadow"><nav class="padding"><h6 class="max bold" id="display-loja">Painel</h6><button class="circle transparent" onclick="logout()"><i>logout</i></button></nav></header>
        <div class="padding responsive">
            
            <div class="card white padding margin shadow">
                <h6>ðŸ”— Link do seu CatÃ¡logo:</h6>
                <p id="share-link" class="blue-text bold" style="word-break: break-all;"></p>
                <button class="border small round" onclick="copiarLink()">Copiar Link</button>
            </div>

            <article class="card white padding margin shadow">
                <h5>âž• Cadastrar Item</h5>
                <div class="field label border round"><input type="text" id="p-nome"><label>Nome do Produto</label></div>
                <div class="field label border round"><input type="number" id="p-preco"><label>PreÃ§o</label></div>
                <div class="field label border round">
                    <input type="file" id="p-file" accept="image/*" capture="environment" onchange="converterFoto()">
                    <label>Foto (CÃ¢mera ou Galeria)</label>
                    <input type="hidden" id="p-img">
                </div>
                <button id="btn-salvar" class="fill green full-width round" onclick="salvarProduto()">Salvar Produto</button>
            </article>

            <h5>ðŸ“¦ Meus Produtos</h5>
            <div id="meus-produtos" class="grid"></div>
        </div>
    </main>

    <script>
        const API_URL = "SUA_NOVA_URL_AQUI";

        function converterFoto() {
            const file = document.getElementById('p-file').files[0];
            const reader = new FileReader();
            reader.onloadend = () => document.getElementById('p-img').value = reader.result;
            if (file) reader.readAsDataURL(file);
        }

        async function handleLogin() {
            const res = await fetch(`${API_URL}?action=login&email=${document.getElementById('email').value}&senha=${document.getElementById('senha').value}`, {redirect: "follow"});
            const user = await res.json();
            if(user.auth) {
                localStorage.setItem('vendedor', user.email);
                localStorage.setItem('lojaNome', user.loja || "Minha Loja");
                abrirPainel();
            } else { alert("Acesso invÃ¡lido!"); }
        }

        function abrirPainel() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('display-loja').innerText = localStorage.getItem('lojaNome');
            document.getElementById('share-link').innerText = `${window.location.origin}/view.html?loja=${localStorage.getItem('vendedor')}`;
            carregarMeusProdutos();
        }

        async function carregarMeusProdutos() {
            const container = document.getElementById('meus-produtos');
            container.innerHTML = "Carregando...";
            const res = await fetch(`${API_URL}?action=getProdutos&dono=${localStorage.getItem('vendedor')}`, {redirect: "follow"});
            const dados = await res.json();
            container.innerHTML = dados.produtos.map(p => `
                <div class="s12 m6 card white padding shadow margin-bottom">
                    <div class="nav">
                        <img src="${p.img}" width="60" height="60" style="object-fit:cover; border-radius:10px">
                        <div class="max"><h6>${p.nome}</h6><p class="green-text bold">R$ ${p.preco}</p></div>
                    </div>
                </div>`).join('');
        }

        async function salvarProduto() {
            const btn = document.getElementById('btn-salvar');
            btn.disabled = true;
            const dados = {
                action: "cadastrarProduto",
                dono: localStorage.getItem('vendedor'),
                nome: document.getElementById('p-nome').value,
                preco: document.getElementById('p-preco').value,
                img: document.getElementById('p-img').value,
                cat: "Geral"
            };
            await fetch(API_URL, { method: 'POST', body: JSON.stringify(dados) });
            alert("Cadastrado!");
            btn.disabled = false;
            carregarMeusProdutos();
        }

        function logout() { localStorage.clear(); location.reload(); }
        function copiarLink() { navigator.clipboard.writeText(document.getElementById('share-link').innerText); alert("Link copiado!"); }
        window.onload = () => { if(localStorage.getItem('vendedor')) abrirPainel(); };
    </script>
</body>
</html>
