<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vitrine Digital Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.js"></script>
    <style>
        :root { --whatsapp: #25D366; }
        body { background: #f8f9fa; }
        .product-card { border-radius: 16px; overflow: hidden; background: white; border: none; transition: 0.3s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .category-badge { background: #eee; padding: 4px 12px; border-radius: 20px; font-size: 12px; }
        .search-container { position: sticky; top: 0; z-index: 100; background: white; padding: 10px; }
    </style>
</head>
<body>

    <header class="primary shadow">
        <nav class="center-align"><h5 class="white-text">üõçÔ∏è Minha Loja Digital</h5></nav>
    </header>

    <div class="search-container shadow">
        <div class="field prefix round fill">
            <i>search</i>
            <input type="text" id="search" placeholder="Buscar produto..." onkeyup="filtrar()">
        </div>
    </div>

    <main class="responsive p-2" id="app">
        <div id="loader" class="center-align m-4">
            <progress class="circle large"></progress>
            <p>Sincronizando com estoque...</p>
        </div>
        <div class="grid" id="lista"></div>
    </main>

    <script>
        // SUA NOVA URL ATUALIZADA
        const API_URL = "https://script.google.com/macros/s/AKfycbypGoFXENiEzRdMeauIF2COeDMACjjs3PX9NicZkI2I_nL9tMW6Ahwu1oebaInIvbwJ/exec";
        let db = [];

        async function init() {
            try {
                // 'redirect: follow' resolve o erro de autoriza√ß√£o
                const res = await fetch(API_URL, { redirect: "follow" });
                db = await res.json();
                render(db);
            } catch (e) {
                document.getElementById('app').innerHTML = "<h5>‚ö†Ô∏è Erro ao carregar. Verifique a URL do Script.</h5>";
            }
        }

        function render(itens) {
            const lista = document.getElementById('lista');
            document.getElementById('loader').style.display = 'none';
            
            lista.innerHTML = itens.map(p => `
                <div class="s12 m6 l4">
                    <div class="card product-card">
                        <img src="${p.img || 'https://via.placeholder.com/400x300'}" class="responsive" style="height:200px; object-fit:cover">
                        <div class="padding">
                            <span class="category-badge">${p.cat}</span>
                            <h6 class="bold" style="margin: 8px 0">${p.nome}</h6>
                            <h5 class="green-text">R$ ${p.preco.toFixed(2)}</h5>
                            <button class="fill green full-width round" onclick="pedir('${p.nome}')" style="background:var(--whatsapp)!important">
                                <i>send</i> Pedir no WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filtrar() {
            const termo = document.getElementById('search').value.toLowerCase();
            const filtrados = db.filter(p => p.nome.toLowerCase().includes(termo) || p.cat.toLowerCase().includes(termo));
            render(filtrados);
        }

        function pedir(nome) {
            const fone = "5527997566512"; 
            const msg = encodeURIComponent("Ol√°! Quero saber sobre o produto: " + nome);
            window.open(`https://wa.me/${fone}?text=${msg}`);
        }

        window.onload = init;
    </script>
</body>
</html>
