<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Catálogo Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.css">
    <style>
        #main-app { display: none; } /* Esconde o app até logar */
        .login-container { height: 100vh; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="login-screen" class="login-container">
        <article class="padding">
            <h5 class="center-align">Acesse seu Catálogo</h5>
            <div class="field label border round margin">
                <input type="email" id="email">
                <label>E-mail</label>
            </div>
            <div class="field label border round margin">
                <input type="password" id="senha">
                <label>Senha</label>
            </div>
            <button class="fill primary full-width" onclick="handleLogin()">Entrar</button>
        </article>
    </div>

    <main id="main-app">
        <header class="primary shadow">
            <nav class="padding">
                <h6 id="welcome" class="max">Bem-vindo</h6>
                <button class="circle transparent" onclick="logout()"><i>logout</i></button>
            </nav>
        </header>
        <div class="grid padding" id="lista"></div>
    </main>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyDKTT2FrGvr8fKCp70-4y96Bz39X3DMOwS0df0RZY8YKdp-9bVwZdRA7OI2Tm4C3vK/exec";

        async function handleLogin() {
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            
            const res = await fetch(`${API_URL}?action=login&email=${email}&senha=${senha}`, { redirect: "follow" });
            const user = await res.json();

            if (user.auth) {
                localStorage.setItem('vendedor_email', user.email);
                localStorage.setItem('vendedor_nome', user.nome);
                abrirApp();
            } else {
                alert("Dados incorretos!");
            }
        }

        function abrirApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            document.getElementById('welcome').innerText = "Loja: " + localStorage.getItem('vendedor_nome');
            carregarProdutos();
        }

        async function carregarProdutos() {
            const email = localStorage.getItem('vendedor_email');
            const res = await fetch(`${API_URL}?action=getProdutos&dono=${email}`, { redirect: "follow" });
            const produtos = await res.json();
            
            document.getElementById('lista').innerHTML = produtos.map(p => `
                <div class="s12 m6 l4">
                    <div class="card shadow">
                        <img src="${p.img}" class="responsive" style="height:150px; object-fit:cover">
                        <div class="padding">
                            <h6 class="bold">${p.nome}</h6>
                            <p class="green-text"><b>R$ ${p.preco.toFixed(2)}</b></p>
                            <button class="fill green full-width">Ver no Zap</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function logout() { localStorage.clear(); location.reload(); }

        // Mantém logado se já tiver entrado antes
        window.onload = () => { if(localStorage.getItem('vendedor_email')) abrirApp(); };
    </script>
</body>
</html>
