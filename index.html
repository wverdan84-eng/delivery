<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SaaS Catálogo</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.css">
<script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.js"></script>
</head>

<body class="light">

<div id="app"></div>

<script>
const API = "COLE_AQUI_URL_DO_WEB_APP";
const qs = new URLSearchParams(location.search);
const page = qs.get("page") || "admin";

/* ================= ADMIN ================= */
if (page === "admin") {
document.getElementById("app").innerHTML = `
<div class="container small padding">
<article class="card center-align">
<h5>Login</h5>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button class="fill primary" onclick="login()">Entrar</button>
</article>
</div>`;
}

async function login() {
  const email = email.value;
  const senha = senha.value;
  const r = await fetch(\`\${API}?action=login&email=\${email}&senha=\${senha}\`);
  const d = await r.json();
  if (!d.auth) return alert("Erro");
  localStorage.setItem("user", JSON.stringify(d));
  location.reload();
}

const user = JSON.parse(localStorage.getItem("user"));
if (user && page === "admin") painel();

function painel() {
document.getElementById("app").innerHTML = `
<header class="primary"><nav><h5>${user.loja}</h5>
<button onclick="logout()">Sair</button></nav></header>

<main class="padding">
<p>Link do catálogo:</p>
<a target="_blank"
href="?page=view&loja=${user.email}">
Abrir Catálogo</a>

<h6>Cadastrar</h6>
<input id="n" placeholder="Nome">
<input id="p" placeholder="Preço">
<input id="e" type="number" placeholder="Estoque">
<input id="c" placeholder="Categoria">
<textarea id="i" placeholder="URL da imagem"></textarea>
<button onclick="salvar()">Salvar</button>

<div id="lista"></div>
</main>`;
load();
}

async function salvar() {
await fetch(API,{
method:"POST",
headers:{ "Content-Type":"application/json"},
body:JSON.stringify({
action:"cadastrarProduto",
dono:user.email,
nome:n.value,
preco:p.value,
estoque:e.value,
cat:c.value,
img:i.value
})
});
load();
}

async function load() {
const r = await fetch(\`\${API}?action=getProdutos&dono=\${user.email}\`);
const d = await r.json();
lista.innerHTML = d.produtos.map(p=>`
<div class="card">
<img src="${p.img||'https://via.placeholder.com/400'}">
<b>${p.nome}</b>
<p>R$ ${p.preco}</p>
<button onclick="del('${p.id}')">Excluir</button>
</div>`).join("");
}

async function del(id){
await fetch(API,{
method:"POST",
headers:{ "Content-Type":"application/json"},
body:JSON.stringify({action:"deletarProduto",id,dono:user.email})
});
load();
}

function logout(){localStorage.clear();location.reload();}

/* ================= CATÁLOGO ================= */
if (page === "view") {
const loja = qs.get("loja");
document.getElementById("app").innerHTML =
"<p class='center-align'>Carregando...</p>";

fetch(\`\${API}?action=getProdutos&dono=\${loja}\`)
.then(r=>r.json())
.then(d=>{
document.getElementById("app").innerHTML = `
<header class="primary"><nav><h5>${d.nomeLoja}</h5></nav></header>
<main class="padding grid">
${d.produtos.map(p=>`
<div class="s12 m4 card">
<img src="${p.img||'https://via.placeholder.com/400'}">
<h6>${p.nome}</h6>
<h5>R$ ${p.preco}</h5>
<button onclick="pedido('${p.nome}','${p.preco}','${d.whatsapp}')">
WhatsApp
</button>
</div>`).join("")}
</main>`;
});
}

function pedido(n,p,z){
window.open(\`https://wa.me/\${z.replace(/\\D/g,'')}?text=Quero: \${n} R$ \${p}\`);
}
</script>
</body>
</html>