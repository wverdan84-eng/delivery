<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Online</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.js"></script>
    <style>
        body { background-color: #f9f9f9; }
        .hero { background: #6200ea; color: white; padding: 40px 20px; text-align: center; border-radius: 0 0 20px 20px; }
        .card-img { width: 100%; height: 250px; object-fit: cover; border-radius: 12px 12px 0 0; }
        .float-btn { position: fixed; bottom: 20px; right: 20px; z-index: 10; }
    </style>
</head>
<body>

    <div class="hero shadow">
        <h4 id="nome-loja">Carregando loja...</h4>
        <p id="nicho-loja">Seja bem-vindo!</p>
    </div>

    <main class="responsive padding" style="margin-top: -30px;">
        <div id="lista" class="grid">
            <div class="s12 center-align"><div class="loader"></div></div>
        </div>
    </main>

    <script>
        const API_URL = "COLE_SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI"; // <--- MESMA URL DO INDEX
        
        const params = new URLSearchParams(window.location.search);
        const lojaEmail = params.get('loja');
        let zapLojista = "";

        async function carregarVitrine() {
            if (!lojaEmail) {
                document.body.innerHTML = "<h3 class='center-align padding'>Loja não encontrada.</h3>";
                return;
            }

            try {
                const req = await fetch(`${API_URL}?action=getProdutos&dono=${lojaEmail}`);
                const res = await req.json();

                document.getElementById('nome-loja').innerText = res.nomeLoja;
                zapLojista = res.whatsapp;

                const div = document.getElementById('lista');
                
                if (!res.produtos || res.produtos.length === 0) {
                    div.innerHTML = "<div class='s12 center-align padding card white'><h5>Nenhum produto disponível no momento.</h5></div>";
                    return;
                }

                div.innerHTML = res.produtos.map(p => `
                    <div class="s12 m6 l4">
                        <div class="card white no-padding shadow" style="border-radius:12px">
                            <img src="${p.img}" class="card-img">
                            <div class="padding">
                                <h5 class="bold">${p.nome}</h5>
                                <div class="row align-center">
                                    <h5 class="green-text bold max">R$ ${p.preco}</h5>
                                    <span class="badge surface">${p.estoque} disp.</span>
                                </div>
                                <button class="fill primary round full-width margin-top large" onclick="pedir('${p.nome}', '${p.preco}')">
                                    <i>send</i> Pedir no WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (e) {
                alert("Erro ao carregar a loja.");
            }
        }

        function pedir(nome, preco) {
            if (!zapLojista) return alert("Esta loja não configurou o WhatsApp.");
            
            // Limpa o número (deixa só digitos)
            const numero = zapLojista.replace(/\D/g, "");
            
            const texto = `Olá! Gostaria de pedir: *${nome}* (R$ ${preco}). Ainda tem disponível?`;
            const link = `https://wa.me/${numero}?text=${encodeURIComponent(texto)}`;
            window.open(link, '_blank');
        }

        window.onload = carregarVitrine;
    </script>
</body>
</html>
