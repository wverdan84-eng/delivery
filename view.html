<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat치logo Digital</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.js"></script>
    <style>
        body { background: #f9f9f9; }
        .img-vitrine { width: 100%; height: 220px; object-fit: cover; border-radius: 12px 12px 0 0; }
        .card-produto { transition: transform 0.2s; border-radius: 16px; border:none; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .card-produto:hover { transform: translateY(-5px); }
    </style>
</head>
<body>

    <header class="primary shadow">
        <nav class="center-align padding">
            <h5 class="bold" id="nome-loja">Carregando Loja...</h5>
        </nav>
    </header>

    <main class="responsive padding">
        <div id="loading" class="center-align padding"><progress class="circle"></progress></div>
        <div id="lista-produtos" class="grid"></div>
    </main>

    <script>
        const API_URL = "SUA_URL_DO_GOOGLE_SCRIPT_AQUI"; // Mesma URL do index
        
        const urlParams = new URLSearchParams(window.location.search);
        const vendedorEmail = urlParams.get('loja');
        let whatsappVendedor = ""; // Armazena o zap do dono

        async function carregarVitrine() {
            if(!vendedorEmail) { 
                document.body.innerHTML = "<div class='padding center-align'><h3>游뛂 Loja n칚o especificada</h3><p>Use o link fornecido pelo vendedor.</p></div>"; 
                return; 
            }

            try {
                const res = await fetch(`${API_URL}?action=getProdutos&dono=${vendedorEmail}`, {redirect: "follow"});
                const dados = await res.json();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('nome-loja').innerText = dados.nomeLoja || "Cat치logo";
                whatsappVendedor = dados.whatsapp; // Captura o Zap vindo do banco

                const container = document.getElementById('lista-produtos');
                if(!dados.produtos || dados.produtos.length === 0) {
                    container.innerHTML = "<div class='s12 center-align'><h5>Esta loja ainda n칚o tem produtos.</h5></div>";
                    return;
                }

                container.innerHTML = dados.produtos.map(p => `
                    <div class="s12 m6 l4">
                        <div class="card white no-padding card-produto">
                            <img src="${p.img}" class="img-vitrine">
                            <div class="padding">
                                <h6 class="bold" style="margin-bottom:5px">${p.nome}</h6>
                                <p class="small gray-text">Estoque: ${p.estoque} unid.</p>
                                <h5 class="green-text bold">R$ ${p.preco}</h5>
                                <button class="fill primary full-width round margin-top waves" onclick="enviarPedido('${p.nome}', '${p.preco}')">
                                    <i>message</i> Pedir no WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch(e) {
                alert("Erro ao carregar loja.");
            }
        }

        function enviarPedido(nome, preco) {
            if(!whatsappVendedor) {
                alert("O lojista n칚o cadastrou um WhatsApp v치lido na planilha.");
                return;
            }
            // Limpeza do n칰mero
            const numeroLimpo = whatsappVendedor.replace(/\D/g, ""); 
            const msg = encodeURIComponent(`Ol치! 游녦\n\nGostaria de comprar:\n*${nome}*\nPre칞o: *R$ ${preco}*\n\nAinda est치 dispon칤vel?`);
            window.open(`https://wa.me/${numeroLimpo}?text=${msg}`, '_blank');
        }

        window.onload = carregarVitrine;
    </script>
</body>
</html>
