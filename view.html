<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Produtos</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.4.13/dist/cdn/beer.min.js"></script>
</head>
<body class="light">
    <header class="primary shadow">
        <nav class="center-align padding">
            <h6 class="bold" id="nome-loja">Carregando loja...</h6>
        </nav>
    </header>

    <main class="responsive padding">
        <div id="lista-clientes" class="grid">
            <progress class="circle center"></progress>
        </div>
    </main>

    <script>
        const API_URL = "SUA_URL_DO_GOOGLE_SCRIPT";
        const urlParams = new URLSearchParams(window.location.search);
        const vendedorEmail = urlParams.get('loja');

        async function carregarVitrine() {
            if(!vendedorEmail) { document.body.innerHTML = "<h1>Loja não encontrada</h1>"; return; }

            const res = await fetch(`${API_URL}?action=getProdutos&dono=${vendedorEmail}`, {redirect: "follow"});
            const dados = await res.json();
            
            document.getElementById('nome-loja').innerText = dados.nomeLoja || "Vitrine Digital";
            
            const container = document.getElementById('lista-clientes');
            container.innerHTML = (dados.produtos || []).map(p => `
                <div class="s12 m6 l4">
                    <div class="card white no-padding shadow">
                        <img src="${p.img}" style="width:100%; height:200px; object-fit:cover">
                        <div class="padding">
                            <p class="bold max" style="font-size:1.2rem">${p.nome}</p>
                            <p class="green-text bold" style="font-size:1.4rem">R$ ${p.preco}</p>
                            <p class="small gray-text">Estoque disponível: ${p.estoque}</p>
                            <button class="fill primary full-width round margin-top" onclick="comprar('${p.nome}', '${p.preco}')">
                                <i>send</i> Pedir pelo WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function comprar(nome, preco) {
            // O WhatsApp do vendedor deve vir do banco de dados (Ação getProdutos deve retornar o zap também)
            // Para simplificar agora, ele gera a mensagem. 
            const msg = encodeURIComponent(`Olá! Vi no seu catálogo e quero o produto: ${nome} (R$ ${preco})`);
            window.open(`https://wa.me/?text=${msg}`);
        }

        window.onload = carregarVitrine;
    </script>
</body>
</html>
